{% extends "base.html" %}
{% block title %}Edit Quiz{% endblock %}
{% block content %}
<h2>Edit Quiz: {{ quiz.title }}</h2>
<form action="{{ url_for('edit_quiz', quiz_id=quiz.id) }}" method="post">
    {{ form.hidden_tag() }}
    <div>
        {{ form.title.label }}<br>
        {{ form.title(size=64) }}
    </div>
    <div>
        {{ form.description.label }}<br>
        {{ form.description(rows=5) }}
    </div>
    <div>
        <button type="submit" class="btn btn-save">Save</button>
        <button type="button" class="btn btn-cancel" onclick="confirmCancel()">Cancel</button>
        <button type="button" class="btn btn-delete" onclick="confirmDeleteQuiz({{ quiz.id }})">Delete</button>
    </div>
</form>
<h3>Questions</h3>
<a href="{{ url_for('add_question', quiz_id=quiz.id) }}" class="btn btn-primary">Add Question</a>
<ul>
    {% for question in quiz.questions %}
    <li>
        {{ question.text }}
        <button class="btn btn-danger" onclick="confirmDeleteQuestion({{ question.id }})">Delete</button>
    </li>
    {% endfor %}
</ul>
{% endblock %}
<script>
function confirmCancel() {
    if (confirm('Are you sure you want to cancel? All unsaved changes will be lost.')) {
        window.location.href = "{{ url_for('manage_quizzes') }}";
    }
}

function confirmDeleteQuiz(quizId) {
    if (confirm('Are you sure you want to delete this quiz?')) {
        fetch(`/delete_quiz/${quizId}`, {
            method: 'POST',
        }).then(response => response.json())
          .then(data => {
              if (data.success) {
                  window.location.href = "{{ url_for('manage_quizzes') }}";
              } else {
                  alert('Failed to delete quiz.');
              }
          });
    }
}

function confirmDeleteQuestion(questionId) {
    if (confirm('Are you sure you want to delete this question?')) {
        fetch(`/delete_question/${questionId}`, {
            method: 'POST',
        }).then(response => response.json())
          .then(data => {
              if (data.success) {
                  location.reload();
              } else {
                  alert('Failed to delete question.');
              }
          });
    }
}
</script>
